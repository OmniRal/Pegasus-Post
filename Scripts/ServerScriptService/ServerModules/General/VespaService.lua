-- OmniRal

local VespaService = {}

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Services
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Modules
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

local Remotes = require(ReplicatedStorage.Source.Pronghorn.Remotes)
local New = require(ReplicatedStorage.Source.Pronghorn.New)

local Utility = require(ReplicatedStorage.Source.SharedModules.Other.Utility)

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Constants
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Remotes
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Variables
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

local VespaFolder: Folder = nil

local Assets = ReplicatedStorage.Assets

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Private Functions
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Public API
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function VespaService.RequestVespa(Player: Player, VespaName: string, Here: CFrame?): string
    local Alive, _, Root = Utility.CheckPlayerAlive(Player)
    if not Alive or not Root then return "Player dead" end
    
    local Model = Assets.Vespas:FindFirstChild(VespaName)
    if not Model then return "Vespa model missing!" end

    if not Here then
        Here = Root.CFrame * CFrame.new(0, 20, -20)
    end

    local NewVespa: Model = Model:Clone()
    NewVespa:PivotTo(Here :: CFrame)
    NewVespa.Parent = VespaFolder
    
    return "Success"
end

function VespaService:Init()
    local NewFolder = New.Instance("Folder", "Vespas", Workspace)
    VespaFolder = NewFolder

    Remotes:CreateToServer("RequestVespa", {"string", "CFrame?"}, "Returns", function(Player: Player, VespaName: string, Here: CFrame?)
        return VespaService.RequestVespa(Player, VespaName, Here)
    end)
end

function VespaService:Deferred()
end

return VespaService